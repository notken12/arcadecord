<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Confetti test Party.js</title>

    <style>
      html,
      body {
        display: flex;
        width: 100%;
        height: 100%;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>

  <body>
    <button id="button" onclick="showConfetti()">Confetti!</button>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <script>
      var runButton = document.querySelector('#button')

      function showConfetti() {
        var duration = 60 * 1000
        var animationEnd = Date.now() + duration
        var skew = 1
        // use bright colorful colors
        var colors = [
          '#ff1744',
          '#f50057',
          '#d500f9',
          '#651fff',
          '#3d5afe',
          '#2979ff',
          '#00b0ff',
          '#00e5ff',
          '#1de9b6',
          '#00e676',
          '#76ff03',
          '#c6ff00',
          '#ffea00',
          '#ffc400',
          '#ff9100',
          '#ff3d00',
        ]

        function randomInRange(min, max) {
          return Math.random() * (max - min) + min
        }

        var previousTimestamp

        ;(function frame(time) {
          var count = window.innerWidth / 35
          var averageInterval = 1000

          var chance = count / averageInterval

          let timeLeft = animationEnd - Date.now()

          if (previousTimestamp === undefined && time !== undefined)
            previousTimestamp = time + 0

          let elapsed = time - previousTimestamp

          let rng = Math.random()
          if (rng <= chance * elapsed) {
            var ticks = window.innerHeight * 1.5
            //skew = Math.max(0.8, skew - 0.001);

            confetti({
              particleCount: 1,
              startVelocity: 0,
              origin: {
                x: Math.random(),
                // since particles fall down, skew start toward the top
                y: 0,
              },
              colors: [colors[Math.floor(Math.random() * colors.length)]],
              gravity: randomInRange(0.9, 1.1),
              drift: randomInRange(-0.4, 0.4),
              shapes: ['square', 'square'],
              ticks: ticks,
            })
          }

          previousTimestamp = time + 0

          if (timeLeft > 0) {
            requestAnimationFrame(frame)
          }
        })()
      }
    </script>
  </body>
</html>
